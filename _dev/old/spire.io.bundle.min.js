var require=function(a,b){var c=require.resolve(a,b||"/"),d=require.modules[c];if(!d)throw new Error("Failed to resolve module "+a+", tried "+c);var e=d._cached?d._cached:d();return e};require.paths=[],require.modules={},require.extensions=[".js",".coffee"],require._core={assert:!0,events:!0,fs:!0,path:!0,vm:!0},require.resolve=function(){return function(a,b){function g(a){if(require.modules[a])return a;for(var b=0;b<require.extensions.length;b++){var c=require.extensions[b];if(require.modules[a+c])return a+c}}function h(a){a=a.replace(/\/+$/,"");var b=a+"/package.json";if(require.modules[b]){var d=require.modules[b](),e=d.browserify;if(typeof e=="object"&&e.main){var f=g(c.resolve(a,e.main));if(f)return f}else if(typeof e=="string"){var f=g(c.resolve(a,e));if(f)return f}else if(d.main){var f=g(c.resolve(a,d.main));if(f)return f}}return g(a+"/index")}function i(a,b){var c=j(b);for(var d=0;d<c.length;d++){var e=c[d],f=g(e+"/"+a);if(f)return f;var i=h(e+"/"+a);if(i)return i}var f=g(a);if(f)return f}function j(a){var b;a==="/"?b=[""]:b=c.normalize(a).split("/");var d=[];for(var e=b.length-1;e>=0;e--){if(b[e]==="node_modules")continue;var f=b.slice(0,e+1).join("/")+"/node_modules";d.push(f)}return d}b||(b="/");if(require._core[a])return a;var c=require.modules.path(),d=b||".";if(a.match(/^(?:\.\.?\/|\/)/)){var e=g(c.resolve(d,a))||h(c.resolve(d,a));if(e)return e}var f=i(a,d);if(f)return f;throw new Error("Cannot find module '"+a+"'")}}(),require.alias=function(a,b){var c=require.modules.path(),d=null;try{d=require.resolve(a+"/package.json","/")}catch(e){d=require.resolve(a,"/")}var f=c.dirname(d),g=(Object.keys||function(a){var b=[];for(var c in a)b.push(c);return b})(require.modules);for(var h=0;h<g.length;h++){var i=g[h];if(i.slice(0,f.length+1)===f+"/"){var j=i.slice(f.length);require.modules[b+j]=require.modules[f+j]}else i===f&&(require.modules[b]=require.modules[f])}},require.define=function(a,b){var c=require._core[a]?"":require.modules.path().dirname(a),d=function(a){return require(a,c)};d.resolve=function(a){return require.resolve(a,c)},d.modules=require.modules,d.define=require.define;var e={exports:{}};require.modules[a]=function(){return require.modules[a]._cached=e.exports,b.call(e.exports,d,e,e.exports,c,a),require.modules[a]._cached=e.exports,e.exports}},typeof process=="undefined"&&(process={}),process.nextTick||(process.nextTick=function(){var a=[],b=typeof window!="undefined"&&window.postMessage&&window.addEventListener;return b&&window.addEventListener("message",function(b){if(b.source===window&&b.data==="browserify-tick"){b.stopPropagation();if(a.length>0){var c=a.shift();c()}}},!0),function(c){b?(a.push(c),window.postMessage("browserify-tick","*")):setTimeout(c,0)}}()),process.title||(process.title="browser"),process.binding||(process.binding=function(a){if(a==="evals")return require("vm");throw new Error("No such module")}),process.cwd||(process.cwd=function(){return"."}),require.define("path",function(a,b,c,d,e){function f(a,b){var c=[];for(var d=0;d<a.length;d++)b(a[d],d,a)&&c.push(a[d]);return c}function g(a,b){var c=0;for(var d=a.length;d>=0;d--){var e=a[d];e=="."?a.splice(d,1):e===".."?(a.splice(d,1),c++):c&&(a.splice(d,1),c--)}if(b)for(;c--;c)a.unshift("..");return a}var h=/^(.+\/(?!$)|\/)?((?:.+?)?(\.[^.]*)?)$/;c.resolve=function(){var a="",b=!1;for(var c=arguments.length;c>=-1&&!b;c--){var d=c>=0?arguments[c]:process.cwd();if(typeof d!="string"||!d)continue;a=d+"/"+a,b=d.charAt(0)==="/"}return a=g(f(a.split("/"),function(a){return!!a}),!b).join("/"),(b?"/":"")+a||"."},c.normalize=function(a){var b=a.charAt(0)==="/",c=a.slice(-1)==="/";return a=g(f(a.split("/"),function(a){return!!a}),!b).join("/"),!a&&!b&&(a="."),a&&c&&(a+="/"),(b?"/":"")+a},c.join=function(){var a=Array.prototype.slice.call(arguments,0);return c.normalize(f(a,function(a,b){return a&&typeof a=="string"}).join("/"))},c.dirname=function(a){var b=h.exec(a)[1]||"",c=!1;return b?b.length===1||c&&b.length<=3&&b.charAt(1)===":"?b:b.substring(0,b.length-1):"."},c.basename=function(a,b){var c=h.exec(a)[2]||"";return b&&c.substr(-1*b.length)===b&&(c=c.substr(0,c.length-b.length)),c},c.extname=function(a){return h.exec(a)[3]||""}}),require.define("/spire.io.js",function(a,b,c,d,e){function h(a){a=a||{},this.api=new g(this,a),this.session=null,this._opts_secret=a.secret}function i(a){this.name="No Session Error",this.message=a||"You need a Spire session to do that.\nCall one of:\nspire.start(callback)\nspire.login(email, password, callback)\nspire.register(user, callback)\n"}var f=a("async"),g=a("./spire/api");b.exports=h,h.prototype.secret=function(){return this._ensureSession(),this.session&&this.session.resources&&this.session.resources.account?this.session.resources.account.secret():null},h.prototype.start=function(a,b){var c=this;this.api.createSession(a,function(a,d){if(a)return b(a);c.session=d,b(null)})},h.prototype.login=function(a,b,c){var d=this;this.api.login(a,b,function(a,b){if(a)return c(a);d.session=b,c(null)})},h.prototype.register=function(a,b){var c=this;this.api.createAccount(a,function(a,d){if(a)return b(a);c.session=d,b(null)})},h.prototype.update=function(a,b){var c=this;this._ensureSession(function(d){if(d)return b(d);c.session.resources.account.update(a,b)})},h.prototype.passwordResetRequest=function(a,b){this.api.passwordResetRequest(a,b)},h.prototype.channel=function(a,b){var c=this;this._ensureSession(function(d){if(d)return b(d);if(c.session._channels[a])return b(null,c.session._channels[a]);c._findOrCreateChannel(a,b)})},h.prototype.channels=function(a){var b=this;this._ensureSession(function(c){if(c)return a(c);b.session.channels(a)})},h.prototype.channels$=function(a){var b=this;this._ensureSession(function(c){if(c)return a(c);b.session.channels$(a)})},h.prototype.subscription=function(a,b,c){var d=typeof b=="string"?[b]:b,e=this;this._ensureSession(function(b){if(b)return c(b);f.forEach(d,function(a,b){e._findOrCreateChannel(a,b)},function(b){if(b)return c(b);e._findOrCreateSubscription(a,d,c)})})},h.prototype.subscriptions=function(a){var b=this;this._ensureSession(function(c){if(c)return a(c);b.session.subscriptions(a)})},h.prototype.subscriptions$=function(a){var b=this;this._ensureSession(function(c){if(c)return a(c);b.session.subscriptions$(a)})},h.prototype.subscribe=function(a,b,c,d){var e=this;typeof b=="function"&&(d=c,c=b),d=d||function(){};var f="anon-"+Date.now()+"-"+Math.random();this._ensureSession(function(g){if(g)return d(g);e.subscription(f,a,function(a,e){return a?d(a):(e.addListener("messages",c),e.startListening(b),d(null,e))})})},h.prototype.publish=function(a,b,c){var d=this;this._ensureSession(function(e){if(e)return c(e);d.channel(a,function(a,d){if(a)return c(a);d.publish(b,c)})})},h.prototype.accountFromUrlAndCapabilities=function(a,b){this.api.accountFromUrlAndCapabilities(a,b)},h.prototype.channelFromUrlAndCapabilities=function(a,b){this.api.channelFromUrlAndCapabilities(a,b)},h.prototype.subscriptionFromUrlAndCapabilities=function(a,b){this.api.subscriptionFromUrlAndCapabilities(a,b)},h.prototype._startSessionFromUrlAndCapabilities=function(a,b){var c=this;this.api.sessionFromUrlAndCapabilities(a,function(a,d){if(a)return b(a);c.session=d,b(null)})},h.prototype.CREATION_RETRY_LIMIT=5,h.prototype._findOrCreateChannel=function(a,b){function e(){d++,c.session.createChannel(a,function(e,g){if(!e)return b(null,g);if(e.status!==409)return b(e);if(d>=c.CREATION_RETRY_LIMIT)return b(new Error("Could not create channel: "+a));f()})}function f(){c.session.channelByName(a,function(a,c){if(a&&a.status!==404)return b(a);if(c)return b(null,c);e()})}var c=this,d=0;this._ensureSession(function(a){if(a)return b(a);f()})},h.prototype._findOrCreateSubscription=function(a,b,c){function f(){e++,d.session.createSubscription({name:a,channelNames:b},function(b,f){if(!b)return c(null,f);if(b.status!==409)return c(b);if(e>=d.CREATION_RETRY_LIMIT)return c(new Error("Could not create subscription: "+a));g()})}function g(){d.session.subscriptionByName(a,function(a,b){if(a&&a.status!==404)return c(a);if(b)return c(null,b);f()})}var d=this,e=0;this._ensureSession(function(a){if(a)return c(a);f()})},i.prototype=new Error,i.constructor=i,h.prototype._ensureSession=function(a){if(this.session){if(a)return a(null);return}if(!this._opts_secret){var b=new i;if(a)return a(b);throw b}if(!a)throw new i;this.start(this._opts_secret,a)}}),require.define("/node_modules/async/package.json",function(a,b,c,d,e){b.exports={main:"./index"}}),require.define("/node_modules/async/index.js",function(a,b,c,d,e){b.exports=a("./lib/async")}),require.define("/node_modules/async/lib/async.js",function(a,b,c,d,e){(function(){var a={},c=this,d=c.async;typeof b!="undefined"&&b.exports?b.exports=a:c.async=a,a.noConflict=function(){return c.async=d,a};var e=function(a,b){if(a.forEach)return a.forEach(b);for(var c=0;c<a.length;c+=1)b(a[c],c,a)},f=function(a,b){if(a.map)return a.map(b);var c=[];return e(a,function(a,d,e){c.push(b(a,d,e))}),c},g=function(a,b,c){return a.reduce?a.reduce(b,c):(e(a,function(a,d,e){c=b(c,a,d,e)}),c)},h=function(a){if(Object.keys)return Object.keys(a);var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b},i=function(a,b){if(a.indexOf)return a.indexOf(b);for(var c=0;c<a.length;c+=1)if(a[c]===b)return c;return-1};typeof process=="undefined"||!process.nextTick?a.nextTick=function(a){setTimeout(a,0)}:a.nextTick=process.nextTick,a.forEach=function(a,b,c){if(!a.length)return c();var d=0;e(a,function(e){b(e,function(b){b?(c(b),c=function(){}):(d+=1,d===a.length&&c())})})},a.forEachSeries=function(a,b,c){if(!a.length)return c();var d=0,e=function(){b(a[d],function(b){b?(c(b),c=function(){}):(d+=1,d===a.length?c():e())})};e()},a.forEachLimit=function(a,b,c,d){if(!a.length||b<=0)return d();var e=0,f=0,g=0;(function h(){if(e===a.length)return d();while(g<b&&f<a.length)c(a[f],function(b){b?(d(b),d=function(){}):(e+=1,g-=1,e===a.length?d():h())}),f+=1,g+=1})()};var j=function(b){return function(){var c=Array.prototype.slice.call(arguments);return b.apply(null,[a.forEach].concat(c))}},k=function(b){return function(){var c=Array.prototype.slice.call(arguments);return b.apply(null,[a.forEachSeries].concat(c))}},l=function(a,b,c,d){var e=[];b=f(b,function(a,b){return{index:b,value:a}}),a(b,function(a,b){c(a.value,function(c,d){e[a.index]=d,b(c)})},function(a){d(a,e)})};a.map=j(l),a.mapSeries=k(l),a.reduce=function(b,c,d,e){a.forEachSeries(b,function(a,b){d(c,a,function(a,d){c=d,b(a)})},function(a){e(a,c)})},a.inject=a.reduce,a.foldl=a.reduce,a.reduceRight=function(b,c,d,e){var g=f(b,function(a){return a}).reverse();a.reduce(g,c,d,e)},a.foldr=a.reduceRight;var m=function(a,b,c,d){var e=[];b=f(b,function(a,b){return{index:b,value:a}}),a(b,function(a,b){c(a.value,function(c){c&&e.push(a),b()})},function(a){d(f(e.sort(function(a,b){return a.index-b.index}),function(a){return a.value}))})};a.filter=j(m),a.filterSeries=k(m),a.select=a.filter,a.selectSeries=a.filterSeries;var n=function(a,b,c,d){var e=[];b=f(b,function(a,b){return{index:b,value:a}}),a(b,function(a,b){c(a.value,function(c){c||e.push(a),b()})},function(a){d(f(e.sort(function(a,b){return a.index-b.index}),function(a){return a.value}))})};a.reject=j(n),a.rejectSeries=k(n);var o=function(a,b,c,d){a(b,function(a,b){c(a,function(c){c?(d(a),d=function(){}):b()})},function(a){d()})};a.detect=j(o),a.detectSeries=k(o),a.some=function(b,c,d){a.forEach(b,function(a,b){c(a,function(a){a&&(d(!0),d=function(){}),b()})},function(a){d(!1)})},a.any=a.some,a.every=function(b,c,d){a.forEach(b,function(a,b){c(a,function(a){a||(d(!1),d=function(){}),b()})},function(a){d(!0)})},a.all=a.every,a.sortBy=function(b,c,d){a.map(b,function(a,b){c(a,function(c,d){c?b(c):b(null,{value:a,criteria:d})})},function(a,b){if(a)return d(a);var c=function(a,b){var c=a.criteria,d=b.criteria;return c<d?-1:c>d?1:0};d(null,f(b.sort(c),function(a){return a.value}))})},a.auto=function(a,b){b=b||function(){};var c=h(a);if(!c.length)return b(null);var d={},f=[],i=function(a){f.unshift(a)},j=function(a){for(var b=0;b<f.length;b+=1)if(f[b]===a){f.splice(b,1);return}},k=function(){e(f,function(a){a()})};i(function(){h(d).length===c.length&&b(null,d)}),e(c,function(c){var e=a[c]instanceof Function?[a[c]]:a[c],f=function(a){if(a)b(a),b=function(){};else{var e=Array.prototype.slice.call(arguments,1);e.length<=1&&(e=e[0]),d[c]=e,k()}},h=e.slice(0,Math.abs(e.length-1))||[],l=function(){return g(h,function(a,b){return a&&d.hasOwnProperty(b)},!0)};if(l())e[e.length-1](f,d);else{var m=function(){l()&&(j(m),e[e.length-1](f,d))};i(m)}})},a.waterfall=function(b,c){if(!b.length)return c();c=c||function(){};var d=function(b){return function(e){if(e)c(e),c=function(){};else{var f=Array.prototype.slice.call(arguments,1),g=b.next();g?f.push(d(g)):f.push(c),a.nextTick(function(){b.apply(null,f)})}}};d(a.iterator(b))()},a.parallel=function(b,c){c=c||function(){};if(b.constructor===Array)a.map(b,function(a,b){a&&a(function(a){var c=Array.prototype.slice.call(arguments,1);c.length<=1&&(c=c[0]),b.call(null,a,c)})},c);else{var d={};a.forEach(h(b),function(a,c){b[a](function(b){var e=Array.prototype.slice.call(arguments,1);e.length<=1&&(e=e[0]),d[a]=e,c(b)})},function(a){c(a,d)})}},a.series=function(b,c){c=c||function(){};if(b.constructor===Array)a.mapSeries(b,function(a,b){a&&a(function(a){var c=Array.prototype.slice.call(arguments,1);c.length<=1&&(c=c[0]),b.call(null,a,c)})},c);else{var d={};a.forEachSeries(h(b),function(a,c){b[a](function(b){var e=Array.prototype.slice.call(arguments,1);e.length<=1&&(e=e[0]),d[a]=e,c(b)})},function(a){c(a,d)})}},a.iterator=function(a){var b=function(c){var d=function(){return a.length&&a[c].apply(null,arguments),d.next()};return d.next=function(){return c<a.length-1?b(c+1):null},d};return b(0)},a.apply=function(a){var b=Array.prototype.slice.call(arguments,1);return function(){return a.apply(null,b.concat(Array.prototype.slice.call(arguments)))}};var p=function(a,b,c,d){var e=[];a(b,function(a,b){c(a,function(a,c){e=e.concat(c||[]),b(a)})},function(a){d(a,e)})};a.concat=j(p),a.concatSeries=k(p),a.whilst=function(b,c,d){b()?c(function(e){if(e)return d(e);a.whilst(b,c,d)}):d()},a.until=function(b,c,d){b()?d():c(function(e){if(e)return d(e);a.until(b,c,d)})},a.queue=function(b,c){var d=0,e={tasks:[],concurrency:c,saturated:null,empty:null,drain:null,push:function(b,d){e.tasks.push({data:b,callback:d}),e.saturated&&e.tasks.length==c&&e.saturated(),a.nextTick(e.process)},process:function(){if(d<e.concurrency&&e.tasks.length){var a=e.tasks.shift();e.empty&&e.tasks.length==0&&e.empty(),d+=1,b(a.data,function(){d-=1,a.callback&&a.callback.apply(a,arguments),e.drain&&e.tasks.length+d==0&&e.drain(),e.process()})}},length:function(){return e.tasks.length},running:function(){return d}};return e};var q=function(a){return function(b){var c=Array.prototype.slice.call(arguments,1);b.apply(null,c.concat([function(b){var c=Array.prototype.slice.call(arguments,1);typeof console!="undefined"&&(b?console.error&&console.error(b):console[a]&&e(c,function(b){console[a](b)}))}]))}};a.log=q("log"),a.dir=q("dir"),a.memoize=function(a,b){var c={},d={};b=b||function(a){return a};var e=function(){var e=Array.prototype.slice.call(arguments),f=e.pop(),g=b.apply(null,e);g in c?f.apply(null,c[g]):g in d?d[g].push(f):(d[g]=[f],a.apply(null,e.concat([function(){c[g]=arguments;var a=d[g];delete d[g];for(var b=0,e=a.length;b<e;b++)a[b].apply(null,arguments)}])))};return e.unmemoized=a,e},a.unmemoize=function(a){return function(){return(a.unmemoized||a).apply(null,arguments)}}})()}),require.define("/spire/api.js",function(a,b,c,d,e){function m(a,b){this.spire=a,b=b||{},this.url=b.url||"https://api.spire.io",this.version=b.version||"1.0",this.timeout=b.timeout||3e4,this.description=null,this.schema=null}var f=a("./api/resource"),g=a("./api/account"),h=a("./api/billing"),i=a("./api/channel"),j=a("./api/message"),k=a("./api/session"),l=a("./api/subscription");b.exports=m,m.prototype.request=f.prototype.request,m.prototype.discover=function(a){var b=this;if(this.description)return process.nextTick(function(){a(null,b.description)});this.request("discover",function(c,d){if(c)return a(c);b.description=d,b.schema=d.schema[b.version],a(null,d)})},m.prototype.createSession=function(a,b){var c=this;this.discover(function(d){if(d)return b(d);c.request("create_session",a,function(a,d){if(a)return b(a);var e=new k(c.spire,d);b(null,e)})})},m.prototype.login=function(a,b,c){var d=this;this.discover(function(e){if(e)return c(e);d.request("login",a,b,function(a,b){if(a)return c(a);var e=new k(d.spire,b);c(null,e)})})},m.prototype.createAccount=function(a,b){var c=this;this.discover(function(d){if(d)return b(d);c.request("create_account",a,function(a,d){if(a)return b(a);var e=new k(c.spire,d);b(null,e)})})},m.prototype.passwordResetRequest=function(a,b){var c=this;this.discover(function(d){if(d)return b(d);c.request("password_reset",a,b)})},m.prototype.billing=function(a){var b=this;this.discover(function(c){if(c)return a(c);b.request("billing",function(c,d){if(c)return a(c);var e=new h(b.spire,d);a(null,e)})})},m.prototype.accountFromUrlAndCapabilities=function(a,b){var c=this;this.discover(function(d){if(d)return b(d);var e=new g(c.spire,a);e.get(b)})},m.prototype.updateAccountWithUrlAndCapability=function(a,b){var c=this;this.discover(function(d){if(d)return b(d);c.request("update_account",a,function(a,d){if(a)return b(a);var e=new g(c.spire,d);b(null,e)})})},m.prototype.channelFromUrlAndCapabilities=function(a,b){var c=this;this.discover(function(d){if(d)return b(d);var e=new i(c.spire,a);e.get(b)})},m.prototype.sessionFromUrlAndCapabilities=function(a,b){var c=this;this.discover(function(d){if(d)return b(d);var e=new k(c.spire,a);e.get(b)})},m.prototype.subscriptionFromUrlAndCapabilities=function(a,b){var c=this;this.discover(function(d){if(d)return b(d);var e=new l(c.spire,a);process.nextTick(function(){b(null,e)})})},m.prototype.mediaType=function(a){if(!this.schema)throw"No description object.  Run `spire.api.discover` first.";if(!this.schema[a])throw"No schema for resource "+a;return this.schema[a].mediaType},m.prototype.authorization=function(a,b){return["Capability",b.capabilities[a]].join(" ")},f.defineRequest(m.prototype,"discover",function(){return{method:"get",url:this.url,headers:{accept:"application/json"}}}),f.defineRequest(m.prototype,"create_session",function(a){return{method:"post",url:this.description.resources.sessions.url,headers:{"Content-Type":this.mediaType("account"),Accept:this.mediaType("session")},content:{secret:a}}}),f.defineRequest(m.prototype,"login",function(a,b){return{method:"post",url:this.description.resources.sessions.url,headers:{"Content-Type":this.mediaType("account"),Accept:this.mediaType("session")},content:{email:a,password:b}}}),f.defineRequest(m.prototype,"create_account",function(a){return{method:"post",url:this.description.resources.accounts.url,headers:{"Content-Type":this.mediaType("account"),Accept:this.mediaType("session")},content:a}}),f.defineRequest(m.prototype,"password_reset",function(a){return{method:"post",url:this.description.resources.accounts.url,content:"",query:{email:a}}}),f.defineRequest(m.prototype,"billing",function(){return{method:"get",url:this.description.resources.billing.url,content:"",headers:{Accept:"application/json"}}}),f.defineRequest(m.prototype,"update_account",function(a){return{method:"put",url:a.url,content:a,headers:{Authorization:"Capability "+a.capability,Accept:this.mediaType("account"),"Content-Type":this.mediaType("account")}}})}),require.define("/spire/api/resource.js",function(a,b,c,d,e){function k(a,b){this.spire=a,this.data=b}var f=a("underscore"),g=a("shred"),h=new g,i=a("./response_error"),j=a("events").EventEmitter;k.prototype=new j,b.exports=k,k.defineRequest=function(a,b,c){a["_req_"+b]=function(){var a=Array.prototype.slice.call(arguments),b=a.pop(),d=c.apply(this,a);return h.request(d).on("error",function(a){var c=new i(a,d);b(c)}).on("success",function(a){b(null,a.body.data)})}},k.prototype.request=function(){var a=Array.prototype.slice.call(arguments),b=a.shift(),c=a[a.length-1];return typeof this["_req_"+b]!="function"?c(new Error("No request defined for "+b)):this["_req_"+b].apply(this,a)},k.prototype.get=function(a){var b=this;this.request("get",function(c,d){if(c)return a(c);b.data=d,a(null,b)})},k.prototype.update=function(a,b){var c=this;this.request("update",a,function(a,d){if(a)return b(a);c.data=d,b(null,c)})},k.prototype["delete"]=function(a){var b=this;this.request("delete",function(c,d){if(c)return a(c);delete b.data,a(null)})},k.prototype.url=function(){return this.data.url},k.prototype.capabilities=function(){return this.data.capabilities},k.prototype.capability=function(a){return this.capabilities()[a]},k.prototype.authorization=function(a,b){var c;return b?typeof b.capability=="function"?c=b.capability(a):c=b.capabilities[a]:c=this.capability(a),"Capability "+c},k.prototype.schema=function(a){a=a||this.resourceName;if(!this.spire.api.schema)throw"No description object.  Run `spire.api.discover` first.";if(!this.spire.api.schema[a])throw"No schema for resource "+a;return this.spire.api.schema[a]},k.prototype.mediaType=function(a){return this.schema(a).mediaType},k.defineRequest(k.prototype,"get",function(){return{method:"get",url:this.url(),headers:{Authorization:this.authorization("get"),Accept:this.mediaType(),"Content-Type":this.mediaType()}}}),k.defineRequest(k.prototype,"update",function(a){return{method:"put",url:this.url(),content:a,headers:{Authorization:this.authorization("update"),Accept:this.mediaType(),"Content-Type":this.mediaType()}}}),k.defineRequest(k.prototype,"delete",function(){return{method:"delete",url:this.url(),headers:{Authorization:this.authorization("delete"),Accept:this.mediaType(),"Content-Type":this.mediaType()}}})}),require.define("/node_modules/underscore/package.json",function(a,b,c,d,e){b.exports={main:"underscore.js"}}),require.define("/node_modules/underscore/underscore.js",function(a,b,c,d,e){((function(){function C(a,b,c){if(a===b)return a!==0||1/a==1/b;if(a==null||b==null)return a===b;a._chain&&(a=a._wrapped),b._chain&&(b=b._wrapped);if(a.isEqual&&y.isFunction(a.isEqual))return a.isEqual(b);if(b.isEqual&&y.isFunction(b.isEqual))return b.isEqual(a);var d=k.call(a);if(d!=k.call(b))return!1;switch(d){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:a==0?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if(typeof a!="object"||typeof b!="object")return!1;var e=c.length;while(e--)if(c[e]==a)return!0;c.push(a);var f=0,g=!0;if(d=="[object Array]"){f=a.length,g=f==b.length;if(g)while(f--)if(!(g=f in a==f in b&&C(a[f],b[f],c)))break}else{if("constructor"in a!="constructor"in b||a.constructor!=b.constructor)return!1;for(var h in a)if(y.has(a,h)){f++;if(!(g=y.has(b,h)&&C(a[h],b[h],c)))break}if(g){for(h in b)if(y.has(b,h)&&!(f--))break;g=!f}}return c.pop(),g}var a=this,d=a._,e={},f=Array.prototype,g=Object.prototype,h=Function.prototype,i=f.slice,j=f.unshift,k=g.toString,l=g.hasOwnProperty,m=f.forEach,n=f.map,o=f.reduce,p=f.reduceRight,q=f.filter,r=f.every,s=f.some,t=f.indexOf,u=f.lastIndexOf,v=Array.isArray,w=Object.keys,x=h.bind,y=function(a){return new G(a)};typeof c!="undefined"?(typeof b!="undefined"&&b.exports&&(c=b.exports=y),c._=y):a._=y,y.VERSION="1.3.1";var z=y.each=y.forEach=function(a,b,c){if(a==null)return;if(m&&a.forEach===m)a.forEach(b,c);else if(a.length===+a.length){for(var d=0,f=a.length;d<f;d++)if(d in a&&b.call(c,a[d],d,a)===e)return}else for(var g in a)if(y.has(a,g)&&b.call(c,a[g],g,a)===e)return};y.map=y.collect=function(a,b,c){var d=[];return a==null?d:n&&a.map===n?a.map(b,c):(z(a,function(a,e,f){d[d.length]=b.call(c,a,e,f)}),a.length===+a.length&&(d.length=a.length),d)},y.reduce=y.foldl=y.inject=function(a,b,c,d){var e=arguments.length>2;a==null&&(a=[]);if(o&&a.reduce===o)return d&&(b=y.bind(b,d)),e?a.reduce(b,c):a.reduce(b);z(a,function(a,f,g){e?c=b.call(d,c,a,f,g):(c=a,e=!0)});if(!e)throw new TypeError("Reduce of empty array with no initial value");return c},y.reduceRight=y.foldr=function(a,b,c,d){var e=arguments.length>2;a==null&&(a=[]);if(p&&a.reduceRight===p)return d&&(b=y.bind(b,d)),e?a.reduceRight(b,c):a.reduceRight(b);var f=y.toArray(a).reverse();return d&&!e&&(b=y.bind(b,d)),e?y.reduce(f,b,c,d):y.reduce(f,b)},y.find=y.detect=function(a,b,c){var d;return A(a,function(a,e,f){if(b.call(c,a,e,f))return d=a,!0}),d},y.filter=y.select=function(a,b,c){var d=[];return a==null?d:q&&a.filter===q?a.filter(b,c):(z(a,function(a,e,f){b.call(c,a,e,f)&&(d[d.length]=a)}),d)},y.reject=function(a,b,c){var d=[];return a==null?d:(z(a,function(a,e,f){b.call(c,a,e,f)||(d[d.length]=a)}),d)},y.every=y.all=function(a,b,c){var d=!0;return a==null?d:r&&a.every===r?a.every(b,c):(z(a,function(a,f,g){if(!(d=d&&b.call(c,a,f,g)))return e}),d)};var A=y.some=y.any=function(a,b,c){b||(b=y.identity);var d=!1;return a==null?d:s&&a.some===s?a.some(b,c):(z(a,function(a,f,g){if(d||(d=b.call(c,a,f,g)))return e}),!!d)};y.include=y.contains=function(a,b){var c=!1;return a==null?c:t&&a.indexOf===t?a.indexOf(b)!=-1:(c=A(a,function(a){return a===b}),c)},y.invoke=function(a,b){var c=i.call(arguments,2);return y.map(a,function(a){return(y.isFunction(b)?b||a:a[b]).apply(a,c)})},y.pluck=function(a,b){return y.map(a,function(a){return a[b]})},y.max=function(a,b,c){if(!b&&y.isArray(a))return Math.max.apply(Math,a);if(!b&&y.isEmpty(a))return-Infinity;var d={computed:-Infinity};return z(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g>=d.computed&&(d={value:a,computed:g})}),d.value},y.min=function(a,b,c){if(!b&&y.isArray(a))return Math.min.apply(Math,a);if(!b&&y.isEmpty(a))return Infinity;var d={computed:Infinity};return z(a,function(a,e,f){var g=b?b.call(c,a,e,f):a;g<d.computed&&(d={value:a,computed:g})}),d.value},y.shuffle=function(a){var b=[],c;return z(a,function(a,d,e){d==0?b[0]=a:(c=Math.floor(Math.random()*(d+1)),b[d]=b[c],b[c]=a)}),b},y.sortBy=function(a,b,c){return y.pluck(y.map(a,function(a,d,e){return{value:a,criteria:b.call(c,a,d,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;return c<d?-1:c>d?1:0}),"value")},y.groupBy=function(a,b){var c={},d=y.isFunction(b)?b:function(a){return a[b]};return z(a,function(a,b){var e=d(a,b);(c[e]||(c[e]=[])).push(a)}),c},y.sortedIndex=function(a,b,c){c||(c=y.identity);var d=0,e=a.length;while(d<e){var f=d+e>>1;c(a[f])<c(b)?d=f+1:e=f}return d},y.toArray=function(a){return a?a.toArray?a.toArray():y.isArray(a)?i.call(a):y.isArguments(a)?i.call(a):y.values(a):[]},y.size=function(a){return y.toArray(a).length},y.first=y.head=function(a,b,c){return b!=null&&!c?i.call(a,0,b):a[0]},y.initial=function(a,b,c){return i.call(a,0,a.length-(b==null||c?1:b))},y.last=function(a,b,c){return b!=null&&!c?i.call(a,Math.max(a.length-b,0)):a[a.length-1]},y.rest=y.tail=function(a,b,c){return i.call(a,b==null||c?1:b)},y.compact=function(a){return y.filter(a,function(a){return!!a})},y.flatten=function(a,b){return y.reduce(a,function(a,c){return y.isArray(c)?a.concat(b?c:y.flatten(c)):(a[a.length]=c,a)},[])},y.without=function(a){return y.difference(a,i.call(arguments,1))},y.uniq=y.unique=function(a,b,c){var d=c?y.map(a,c):a,e=[];return y.reduce(d,function(c,d,f){if(0==f||(b===!0?y.last(c)!=d:!y.include(c,d)))c[c.length]=d,e[e.length]=a[f];return c},[]),e},y.union=function(){return y.uniq(y.flatten(arguments,!0))},y.intersection=y.intersect=function(a){var b=i.call(arguments,1);return y.filter(y.uniq(a),function(a){return y.every(b,function(b){return y.indexOf(b,a)>=0})})},y.difference=function(a){var b=y.flatten(i.call(arguments,1));return y.filter(a,function(a){return!y.include(b,a)})},y.zip=function(){var a=i.call(arguments),b=y.max(y.pluck(a,"length")),c=new Array(b);for(var d=0;d<b;d++)c[d]=y.pluck(a,""+d);return c},y.indexOf=function(a,b,c){if(a==null)return-1;var d,e;if(c)return d=y.sortedIndex(a,b),a[d]===b?d:-1;if(t&&a.indexOf===t)return a.indexOf(b);for(d=0,e=a.length;d<e;d++)if(d in a&&a[d]===b)return d;return-1},y.lastIndexOf=function(a,b){if(a==null)return-1;if(u&&a.lastIndexOf===u)return a.lastIndexOf(b);var c=a.length;while(c--)if(c in a&&a[c]===b)return c;return-1},y.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=arguments[2]||1;var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=new Array(d);while(e<d)f[e++]=a,a+=c;return f};var B=function(){};y.bind=function(a,b){var c,d;if(a.bind===x&&x)return x.apply(a,i.call(arguments,1));if(!y.isFunction(a))throw new TypeError;return d=i.call(arguments,2),c=function(){if(this instanceof c){B.prototype=a.prototype;var e=new B,f=a.apply(e,d.concat(i.call(arguments)));return Object(f)===f?f:e}return a.apply(b,d.concat(i.call(arguments)))}},y.bindAll=function(a){var b=i.call(arguments,1);return b.length==0&&(b=y.functions(a)),z(b,function(b){a[b]=y.bind(a[b],a)}),a},y.memoize=function(a,b){var c={};return b||(b=y.identity),function(){var d=b.apply(this,arguments);return y.has(c,d)?c[d]:c[d]=a.apply(this,arguments)}},y.delay=function(a,b){var c=i.call(arguments,2);return setTimeout(function(){return a.apply(a,c)},b)},y.defer=function(a){return y.delay.apply(y,[a,1].concat(i.call(arguments,1)))},y.throttle=function(a,b){var c,d,e,f,g,h=y.debounce(function(){g=f=!1},b);return function(){c=this,d=arguments;var i=function(){e=null,g&&a.apply(c,d),h()};e||(e=setTimeout(i,b)),f?g=!0:a.apply(c,d),h(),f=!0}},y.debounce=function(a,b){var c;return function(){var d=this,e=arguments,f=function(){c=null,a.apply(d,e)};clearTimeout(c),c=setTimeout(f,b)}},y.once=function(a){var b=!1,c;return function(){return b?c:(b=!0,c=a.apply(this,arguments))}},y.wrap=function(a,b){return function(){var c=[a].concat(i.call(arguments,0));return b.apply(this,c)}},y.compose=function(){var a=arguments;return function(){var b=arguments;for(var c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}},y.after=function(a,b){return a<=0?b():function(){if(--a<1)return b.apply(this,arguments)}},y.keys=w||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[];for(var c in a)y.has(a,c)&&(b[b.length]=c);return b},y.values=function(a){return y.map(a,y.identity)},y.functions=y.methods=function(a){var b=[];for(var c in a)y.isFunction(a[c])&&b.push(c);return b.sort()},y.extend=function(a){return z(i.call(arguments,1),function(b){for(var c in b)a[c]=b[c]}),a},y.defaults=function(a){return z(i.call(arguments,1),function(b){for(var c in b)a[c]==null&&(a[c]=b[c])}),a},y.clone=function(a){return y.isObject(a)?y.isArray(a)?a.slice():y.extend({},a):a},y.tap=function(a,b){return b(a),a},y.isEqual=function(a,b){return C(a,b,[])},y.isEmpty=function(a){if(y.isArray(a)||y.isString(a))return a.length===0;for(var b in a)if(y.has(a,b))return!1;return!0},y.isElement=function(a){return!!a&&a.nodeType==1},y.isArray=v||function(a){return k.call(a)=="[object Array]"},y.isObject=function(a){return a===Object(a)},y.isArguments=function(a){return k.call(a)=="[object Arguments]"},y.isArguments(arguments)||(y.isArguments=function(a){return!!a&&!!y.has(a,"callee")}),y.isFunction=function(a){return k.call(a)=="[object Function]"},y.isString=function(a){return k.call(a)=="[object String]"},y.isNumber=function(a){return k.call(a)=="[object Number]"},y.isNaN=function(a){return a!==a},y.isBoolean=function(a){return a===!0||a===!1||k.call(a)=="[object Boolean]"},y.isDate=function(a){return k.call(a)=="[object Date]"},y.isRegExp=function(a){return k.call(a)=="[object RegExp]"},y.isNull=function(a){return a===null},y.isUndefined=function(a){return a===void 0},y.has=function(a,b){return l.call(a,b)},y.noConflict=function(){return a._=d,this},y.identity=function(a){return a},y.times=function(a,b,c){for(var d=0;d<a;d++)b.call(c,d)},y.escape=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},y.mixin=function(a){z(y.functions(a),function(b){I(b,y[b]=a[b])})};var D=0;y.uniqueId=function(a){var b=D++;return a?a+b:b},y.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var E=/.^/,F=function(a){return a.replace(/\\\\/g,"\\").replace(/\\'/g,"'")};y.template=function(a,b){var c=y.templateSettings,d="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+a.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(c.escape||E,function(a,b){return"',_.escape("+F(b)+"),'"}).replace(c.interpolate||E,function(a,b){return"',"+F(b)+",'"}).replace(c.evaluate||E,function(a,b){return"');"+F(b).replace(/[\r\n\t]/g," ")+";__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');",e=new Function("obj","_",d);return b?e(b,y):function(a){return e.call(this,a,y)}},y.chain=function(a){return y(a).chain()};var G=function(a){this._wrapped=a};y.prototype=G.prototype;var H=function(a,b){return b?y(a).chain():a},I=function(a,b){G.prototype[a]=function(){var a=i.call(arguments);return j.call(a,this._wrapped),H(b.apply(y,a),this._chain)}};y.mixin(y),z(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=f[a];G.prototype[a]=function(){var c=this._wrapped;b.apply(c,arguments);var d=c.length;return(a=="shift"||a=="splice")&&d===0&&delete c[0],H(c,this._chain)}}),z(["concat","join","slice"],function(a){var b=f[a];G.prototype[a]=function(){return H(b.apply(this._wrapped,arguments),this._chain)}}),G.prototype.chain=function(){return this._chain=!0,this},G.prototype.value=function(){return this._wrapped}})).call(this)}),require.define("/node_modules/shred/package.json",function(a,b,c,d,e){b.exports={main:"./lib/shred.js"}}),require.define("/node_modules/shred/lib/shred.js",function(a,b,c,d,e){var f=a("underscore"),g=a("ax"),h=a("cookiejar"),i=h.CookieJar,j=function(a){a=a||{},this.agent=a.agent,this.defaults=a.defaults||{},this.log=a.logger||new g({level:"info"}),this._sharedCookieJar=new i};j.Request=a("./shred/request"),j.Response=a("./shred/response"),j.prototype={request:function(a){return a.logger=this.log,a.cookieJar="cookieJar"in a?a.cookieJar:this._sharedCookieJar,a.agent=a.agent||this.agent,new j.Request(f.defaults(a,this.defaults))}},"get put post delete".split(" ").forEach(function(a){j.prototype[a]=function(b){return b.method=a,this.request(b)}}),b.exports=j}),require.define("/node_modules/shred/node_modules/ax/package.json",function(a,b,c,d,e){b.exports={main:"./lib/ax.js"}}),require.define("/node_modules/shred/node_modules/ax/lib/ax.js",function(a,b,c,d,e){var f=a("util").inspect,g=a("fs"),h=a("colors"),i=a("underscore"),j=function(a,b){var c=a=="debug"||a=="error";return b?typeof b=="object"?b instanceof Error&&c?b.stack:f(b):b.toString():b.toString()},k=function(a){return this},l=function(a,b){return function(b){return this.stream.write(this.format(a,b)+"\n"),this}},m=function(a){var b=this,a=a||{};b.options=i.defaults(a,{level:"info",timestamp:!0,colors:{info:"green",warn:"yellow",debug:"cyan",error:"red"},prefix:""}),b.options.module&&(b.options.prefix=b.options.module),b.options.file?b.stream=g.createWriteStream(b.options.file,{flags:"a"}):process.title==="node"?b.stream=process.stderr:process.title==="browser"&&(b.stream=function(){return console[b.options.level].apply(console,arguments)});switch(b.options.level){case"debug":i.each(["debug","info","warn"],function(a){b[a]=m.writer(a)});case"info":i.each(["info","warn"],function(a){b[a]=m.writer(a)});case"warn":b.warn=m.writer("warn")}};m.writer=function(a){return function(b){var c=this;process.title==="node"?c.stream.write(c.format(a,b)+"\n"):process.title==="browser"&&c.stream(c.format(a,b)+"\n")}},m.prototype={info:function(){},debug:function(){},warn:function(){},error:m.writer("error"),format:function(a,b){if(!b)return"";var c=this,d=c.options.prefix,e=c.options.timestamp?" "+(new Date).toISOString():"",f=c.options.colors[a];return(d+e+": "+b)[f]}},b.exports=m}),require.define("util",function(a,b,c,d,e){}),require.define("fs",function(a,b,c,d,e){}),require.define("/node_modules/shred/node_modules/ax/node_modules/colors/package.json",function(a,b,c,d,e){b.exports={main:"colors"}}),require.define("/node_modules/shred/node_modules/ax/node_modules/colors/colors.js",function(a,b,c,d,e){function g(a,b){var c={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[90,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};return"["+c[b][0]+"m"+a+"["+c[b][1]+"m"}function h(a,b){function f(a){return r=Math.floor(Math.random()*a),r}function g(a){var b=!1;return d.filter(function(c){b=c==a}),b}function h(a,b){result="",b=b||{},b.up=b.up||!0,b.mid=b.mid||!0,b.down=b.down||!0,b.size=b.size||"maxi";var d;a=a.split("");for(var e in a){if(g(e))continue;result+=a[e],d={up:0,down:0,mid:0};switch(b.size){case"mini":d.up=f(8),d.min=f(2),d.down=f(8);break;case"maxi":d.up=f(16)+3,d.min=f(4)+1,d.down=f(64)+3;break;default:d.up=f(8)+1,d.mid=f(6)/2,d.down=f(8)+1}var h=["up","mid","down"];for(var i in h){var j=h[i];for(var k=0;k<=d[j];k++)b[j]&&(result+=c[j][f(c[j].length)])}}return result}var c={up:["̍","̎","̄","̅","̿","̑","̆","̐","͒","͗","͑","̇","̈","̊","͂","̓","̈","͊","͋","͌","̃","̂","̌","͐","̀","́","̋","̏","̒","̓","̔","̽","̉","ͣ","ͤ","ͥ","ͦ","ͧ","ͨ","ͩ","ͪ","ͫ","ͬ","ͭ","ͮ","ͯ","̾","͛","͆","̚"],down:["̖","̗","̘","̙","̜","̝","̞","̟","̠","̤","̥","̦","̩","̪","̫","̬","̭","̮","̯","̰","̱","̲","̳","̹","̺","̻","̼","ͅ","͇","͈","͉","͍","͎","͓","͔","͕","͖","͙","͚","̣"],mid:["̕","̛","̀","́","͘","̡","̢","̧","̨","̴","̵","̶","͜","͝","͞","͟","͠","͢","̸","̷","͡"," ҉"]},d=[].concat(c.up,c.down,c.mid),e={};return h(a)}var f=typeof b!="undefined";["bold","underline","italic","inverse","grey","yellow","red","green","blue","white","cyan","magenta"].forEach(function(a){String.prototype.__defineGetter__(a,function(){return f?g(this,a):this.replace(/( )/,"$1")})}),String.prototype.__defineGetter__("rainbow",function(){if(!f)return this.replace(/( )/,"$1");var a=["red","yellow","green","blue","magenta"],b=this.split(""),c=0;return b=b.map(function(b){return b==" "?b:g(b,a[c++%a.length])}),b.join("")}),String.prototype.__defineGetter__("zalgo",function(){return h(this)})}),require.define("/node_modules/shred/node_modules/cookiejar/package.json",function(a,b,c,d,e){b.exports={main:"cookiejar.js"}}),require.define("/node_modules/shred/node_modules/cookiejar/cookiejar.js",function(a,b,c,d,e){c.CookieAccessInfo=CookieAccessInfo=function g(a,b,c,d){return this instanceof g?(this.domain=a||undefined,this.path=b||"/",this.secure=!!c,this.script=!!d,this):new g(a,b,c,d)},c.Cookie=Cookie=function h(a){return a instanceof h?a:this instanceof h?(this.name=null,this.value=null,this.expiration_date=Infinity,this.path="/",this.domain=null,this.secure=!1,this.noscript=!1,a&&this.parse(a),this):new h(a)},Cookie.prototype.toString=function(){var a=[this.name+"="+this.value];return this.expiration_date!==Infinity&&a.push("expires="+(new Date(this.expiration_date)).toGMTString()),this.domain&&a.push("domain="+this.domain),this.path&&a.push("path="+this.path),this.secure&&a.push("secure"),this.noscript&&a.push("httponly"),a.join("; ")},Cookie.prototype.toValueString=function(){return this.name+"="+this.value};var f=/[:](?=\s*[a-zA-Z0-9_\-]+\s*[=])/g;Cookie.prototype.parse=function(a){if(this instanceof Cookie){var b=a.split(";"),c=b[0].match(/([^=]+)=((?:.|\n)*)/),d=c[1],e=c[2];this.name=d,this.value=e;for(var f=1;f<b.length;f++){c=b[f].match(/([^=]+)(?:=((?:.|\n)*))?/),d=c[1].trim().toLowerCase(),e=c[2];switch(d){case"httponly":this.noscript=!0;break;case"expires":this.expiration_date=e?Number(Date.parse(e)):Infinity;break;case"path":this.path=e?e.trim():"";break;case"domain":this.domain=e?e.trim():"";break;case"secure":this.secure=!0}}return this}return(new Cookie).parse(a)},Cookie.prototype.matches=function(a){return this.noscript&&a.script||this.secure&&!a.secure||!this.collidesWith(a)?!1:!0},Cookie.prototype.collidesWith=function(a){if(this.path&&!a.path||this.domain&&!a.domain)return!1;if(this.path&&a.path.indexOf(this.path)!==0)return!1;if(this.domain===a.domain)return!0;if(this.domain&&this.domain.charAt(0)==="."){var b=a.domain.indexOf(this.domain.slice(1));if(b===-1||b!==a.domain.length-this.domain.length+1)return!1}else if(this.domain)return!1;return!0},c.CookieJar=CookieJar=function n(){if(this instanceof n){var a={};return this.setCookie=function b(b){b=Cookie(b);var c=b.expiration_date<=Date.now();if(b.name in a){var d=a[b.name];for(var e=0;e<d.length;e++){var f=d[e];if(f.collidesWith(b))return c?(d.splice(e,1),d.length===0&&delete a[b.name],!1):d[e]=b}return c?!1:(d.push(b),b)}return c?!1:a[b.name]=[b]},this.getCookie=function c(b,c){var d=a[b];for(var e=0;e<d.length;e++){var f=d[e];if(f.expiration_date<=Date.now()){d.length===0&&delete a[f.name];continue}if(f.matches(c))return f}},this.getCookies=function d(b){var c=[];for(var d in a){var e=this.getCookie(d,b);e&&c.push(e)}return c.toString=function(){return c.join(":")},c.toValueString=function(){return c.map(function(a){return a.toValueString()}).join(";")},c},this}return new n},CookieJar.prototype.setCookies=function(a){a=Array.isArray(a)?a:a.split(f);var b=[];for(var c=0;c<a.length;c++){var d=Cookie(a[c]);this.setCookie(d)&&b.push(d)}return b}}),require.define("/node_modules/shred/lib/shred/request.js",function(a,b,c,d,e){var f=a("http"),g=a("https"),h=a("./parseUri"),i=a("events").EventEmitter,j=a("sprintf").sprintf,k=a("underscore"),l=a("./response"),m=a("./mixins/headers"),n=a("./content"),o=f.STATUS_CODES,p=function(a){this.log=a.logger,this.cookieJar=a.cookieJar,q(this,a||{}),r(this)};Object.defineProperties(p.prototype,{url:{get:function(){return this.scheme?j("%s://%s:%s%s",this.scheme,this.host,this.port,(this.proxy?"/":this.path)+(this.query?"?"+this.query:"")):null},set:function(a){return a=h(a),this.scheme=a.protocol,this.host=a.host,this.port=a.port,this.path=a.path,this.query=a.query,this},enumerable:!0},headers:{get:function(){return this.getHeaders()},enumerable:!0},port:{get:function(){if(!this._port)switch(this.scheme){case"https":return this._port=443;case"http":default:return this._port=80}return this._port},set:function(a){return this._port=a,this},enumerable:!0},method:{get:function(){return this._method=this._method||"GET"},set:function(a){return this._method=a,this},enumerable:!0},query:{get:function(){return this._query},set:function(a){var b=function(a){var b="";for(var c in a)b+=encodeURIComponent(c)+"="+encodeURIComponent(a[c])+"&";return b=b.slice(0,-1),b};return a?(typeof a=="object"&&(a=b(a)),this._query=a):this._query="",this},enumerable:!0},parameters:{get:function(){return QueryString.parse(this._query||"")},enumerable:!0},body:{get:function(){return this._body},set:function(a){return this._body=new n({data:a,type:this.getHeader("Content-Type")}),this.setHeader("Content-Type",this.content.type),this.setHeader("Content-Length",this.content.length),this},enumerable:!0},timeout:{get:function(){return this._timeout},set:function(a){var b=this,c=0;return a?(typeof options=="number"?c=options:c=(options.milliseconds||0)+1e3*((options.seconds||0)+60*((options.minutes||0)+60*(options.hours||0))),this._timeout=c,this):this},enumerable:!0}}),Object.defineProperty(p.prototype,"content",Object.getOwnPropertyDescriptor(p.prototype,"body")),k.extend(p.prototype,{inspect:function(){var a=this,b=k(a.headers).reduce(function(a,b,c){return a.push("\t"+c+": "+b),a},[]).join("\n"),c=["<Shred Request> ",a.method.toUpperCase(),a.url].join(" ");return[c,"- Headers:",b].join("\n")}}),k.extend(p.prototype,{on:function(a,b){var c=this.emitter;return arguments.length===1&&typeof a=="function"?c.on("response",a):arguments.length===1&&typeof a=="object"?k(a).each(function(a,b){c.on(b,a)}):c.on(a,b),this}}),m.gettersAndSetters(p);var q=function(a,b){a.log.debug("Processing request options .."),a.emitter=new i,a.agent=b.agent,b.on&&k(b.on).each(function(b,c){a.emitter.on(c,b)});if(!b.url&&!b.host){a.emitter.emit("request_error",new Error("No url or url options (host, port, etc.)"));return}b.url&&(b.proxy?(a.url=b.proxy,a.path=b.url):a.url=b.url),a.query=b.query||b.parameters,a.method=b.method,a.setHeader("user-agent",b.agent||"Shred for Node.js, Version 0.5.0"),a.setHeaders(b.headers);if(a.cookieJar){var c=a.cookieJar.getCookies(CookieAccessInfo(a.host,a.path));if(c.length){var d=a.getHeader("cookie")||"";for(var e=0;e<c.length;++e)d.length&&d[d.length-1]!=";"&&(d+=";"),d+=c[e].name+"="+c[e].value+";";a.setHeader("cookie",d)}}if(b.body||b.content)a.content=b.body||b.content;a.timeout=b.timeout},r=function(a){var b;a.log.debug("Creating request .."),a.log.debug(a);var c={host:a.host,port:a.port,method:a.method,path:a.path+(a.query?"?"+a.query:""),headers:a.getHeaders(),scheme:a.scheme,agent:a.agent},d=a.scheme=="http"?f:g;a._raw=d.request(c,function(c){a.log.debug("Received response .."),clearTimeout(b),c=new l(c,a,function(b){var c=function(c){var d=a.emitter,e=o[b.status]?o[b.status].toLowerCase():null;d.listeners(b.status).length>0||d.listeners(e).length>0?(d.emit(b.status,b),d.emit(e,b)):d.listeners(c).length>0?d.emit(c,b):b.isRedirect||(d.emit("response",b),console.warn("Request has no event listener for status code "+b.status))};b.isRedirect?(a.log.debug("Redirecting to "+b.getHeader("Location")),a.url=b.getHeader("Location"),c("redirect"),r(a)):b.isError?c("error"):c("success")})}),a._raw.on("error",function(b){a.emitter.emit("request_error",b)}),a._raw.on("socket",function(b){a.emitter.emit("socket",b)}),a._raw.on("socket",function(){a._raw.socket.on("timeout",function(){a._raw.abort()})}),a.content&&(a.log.debug("Streaming body: '"+a.content.body.slice(0,59)+"' ... "),a._raw.write(a.content.body)),a.timeout&&(b=setTimeout(function(){a.log.debug("Timeout fired, aborting request ..."),a._raw.abort(),a.emit("timeout",a)},a.timeout)),a.log.debug("Sending request ..."),a._raw.end()};b.exports=p}),require.define("http",function(a,b,c,d,e){}),require.define("https",function(a,b,c,d,e){}),require.define("/node_modules/shred/lib/shred/parseUri.js",function(a,b,c,d,e){function f(a){var b=f.options,c=b.parser[b.strictMode?"strict":"loose"].exec(a),d={},e=14;while(e--)d[b.key[e]]=c[e]||"";return d[b.q.name]={},d[b.key[12]].replace(b.q.parser,function(a,c,e){c&&(d[b.q.name][c]=e)}),d}f.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},b.exports=f}),require.define("events",function(a,b,c,d,e){process.EventEmitter||(process.EventEmitter=function(){});var f=c.EventEmitter=process.EventEmitter,g=typeof Array.isArray=="function"?Array.isArray:function(a){return Object.toString.call(a)==="[object Array]"},h=10;f.prototype.setMaxListeners=function(a){this._events||(this._events={}),this._events.maxListeners=a},f.prototype.emit=function(a){if(a==="error")if(!this._events||!this._events.error||g(this._events.error)&&!this._events.error.length)throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");if(!this._events)return!1;var b=this._events[a];if(!b)return!1;if(typeof b=="function"){switch(arguments.length){case 1:b.call(this);break;case 2:b.call(this,arguments[1]);break;case 3:b.call(this,arguments[1],arguments[2]);break;default:var c=Array.prototype.slice.call(arguments,1);b.apply(this,c)}return!0}if(g(b)){var c=Array.prototype.slice.call(arguments,1),d=b.slice();for(var e=0,f=d.length;e<f;e++)d[e].apply(this,c);return!0}return!1},f.prototype.addListener=function(a,b){if("function"!=typeof b)throw new Error("addListener only takes instances of Function");this._events||(this._events={}),this.emit("newListener",a,b);if(!this._events[a])this._events[a]=b;else if(g(this._events[a])){if(!this._events[a].warned){var c;this._events.maxListeners!==undefined?c=this._events.maxListeners:c=h,c&&c>0&&this._events[a].length>c&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),console.trace())}this._events[a].push(b)}else this._events[a]=[this._events[a],b];return this},f.prototype.on=f.prototype.addListener,f.prototype.once=function(a,b){var c=this;return c.on(a,function d(){c.removeListener(a,d),b.apply(this,arguments)}),this},f.prototype.removeListener=function(a,b){if("function"!=typeof b)throw new Error("removeListener only takes instances of Function");if(!this._events||!this._events[a])return this;var c=this._events[a];if(g(c)){var d=c.indexOf(b);if(d<0)return this;c.splice(d,1),c.length==0&&delete this._events[a]}else this._events[a]===b&&delete this._events[a];return this},f.prototype.removeAllListeners=function(a){return a&&this._events&&this._events[a]&&(this._events[a]=null),this},f.prototype.listeners=function(a){return this._events||(this._events={}),this._events[a]||(this._events[a]=[]),g(this._events[a])||(this._events[a]=[this._events[a]]),this._events[a]}}),require.define("/node_modules/shred/node_modules/sprintf/package.json",function(a,b,c,d,e){b.exports={main:"./lib/sprintf"}}),require.define("/node_modules/shred/node_modules/sprintf/lib/sprintf.js",function(a,b,c,d,e){var f=function(){function a(a){return Object.prototype.toString.call(a).slice(8,-1).toLowerCase()}function b(a,b){for(var c=[];b>0;c[--b]=a);return c.join("")}var c=function(){return c.cache.hasOwnProperty(arguments[0])||(c.cache[arguments[0]]=c.parse(arguments[0])),c.format.call(null,c.cache[arguments[0]],arguments)};return c.format=function(c,d){var e=1,g=c.length,h="",i,j=[],k,l,m,n,o,p;for(k=0;k<g;k++){h=a(c[k]);if(h==="string")j.push(c[k]);else if(h==="array"){m=c[k];if(m[2]){i=d[e];for(l=0;l<m[2].length;l++){if(!i.hasOwnProperty(m[2][l]))throw f('[sprintf] property "%s" does not exist',m[2][l]);i=i[m[2][l]]}}else m[1]?i=d[m[1]]:i=d[e++];if(/[^s]/.test(m[8])&&a(i)!="number")throw f("[sprintf] expecting number but found %s",a(i));switch(m[8]){case"b":i=i.toString(2);break;case"c":i=String.fromCharCode(i);break;case"d":i=parseInt(i,10);break;case"e":i=m[7]?i.toExponential(m[7]):i.toExponential();break;case"f":i=m[7]?parseFloat(i).toFixed(m[7]):parseFloat(i);break;case"o":i=i.toString(8);break;case"s":i=(i=String(i))&&m[7]?i.substring(0,m[7]):i;break;case"u":i=Math.abs(i);break;case"x":i=i.toString(16);break;case"X":i=i.toString(16).toUpperCase()}i=/[def]/.test(m[8])&&m[3]&&i>=0?"+"+i:i,o=m[4]?m[4]=="0"?"0":m[4].charAt(1):" ",p=m[6]-String(i).length,n=m[6]?b(o,p):"",j.push(m[5]?i+n:n+i)}}return j.join("")},c.cache={},c.parse=function(a){var b=a,c=[],d=[],e=0;while(b){if((c=/^[^\x25]+/.exec(b))!==null)d.push(c[0]);else if((c=/^\x25{2}/.exec(b))!==null)d.push("%");else{if((c=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(b))===null)throw"[sprintf] huh?";if(c[2]){e|=1;var f=[],g=c[2],h=[];if((h=/^([a-z_][a-z_\d]*)/i.exec(g))===null)throw"[sprintf] huh?";f.push(h[1]);while((g=g.substring(h[0].length))!=="")if((h=/^\.([a-z_][a-z_\d]*)/i.exec(g))!==null)f.push(h[1]);else if((h=/^\[(\d+)\]/.exec(g))!==null)f.push(h[1]);else throw"[sprintf] huh?";c[2]=f}else e|=2;if(e===3)throw"[sprintf] mixing positional and named placeholders is not (yet) supported";d.push(c)}b=b.substring(c[0].length)}return d},c}(),g=function(a,b){return b.unshift(a),f.apply(null,b)};c.sprintf=f,c.vsprintf=g}),require.define("/node_modules/shred/lib/shred/response.js",function(a,b,c,d,e){var f=a("underscore"),g=a("./content"),h=a("./mixins/headers"),i=a("cookiejar"),j=i.Cookie,k=null;try{k=a("zlib")}catch(l){console.warn("no zlib library")}var m=function(a,b,c){var d=this;this._raw=a,this._setHeaders.call(this,a.headers);if(b.cookieJar&&this.getHeader("set-cookie")){var e=this.getHeader("set-cookie"),f=[],h;for(var i=0;i<e.length;i++){var l=e[i];if(!l)continue;l.match(/domain\=/i)||(l+="; domain="+b.host),l.match(/path\=/i)||(l+="; path="+b.path);try{h=new j(cookieStr),h&&f.push(h)}catch(m){console.warn("Tried to set bad cookie: "+l)}}b.cookieJar.setCookies(cookies)}this.request=b,this.client=b.client,this.log=this.request.log;var n=[],o=0;a.on("data",function(a){n.push(a),o+=a.length}),a.on("end",function(){var a;if(typeof Buffer=="undefined")a=n.join("");else{a=new Buffer(o);for(var b=0,e=0;b<n.length;b++)n[b].copy(a,e),e+=n[b].length}var f=function(a){d._body=new g({body:a,type:d.getHeader("Content-Type")}),c(d)};k&&d.getHeader("Content-Encoding")==="gzip"?k.gunzip(a,function(b,c){a=c.toString(),f(a)}):f(a)})};m.prototype={inspect:function(){var a=this,b=f(a.headers).reduce(function(a,b,c){return a.push("\t"+c+": "+b),a},[]).join("\n"),c=["<Shred Response> ",a.status].join(" ");return[c,"- Headers:",b].join("\n")}},Object.defineProperties(m.prototype,{status:{get:function(){return this._raw.statusCode},enumerable:!0},body:{get:function(){return this._body}},content:{get:function(){return this.body},enumerable:!0},isRedirect:{get:function(){return this.status>299&&this.status<400&&this.getHeader("Location")},enumerable:!0},isError:{get:function(){return this.status===0||this.status>399},enumerable:!0}}),h.getters(m),h.privateSetters(m);var n=m.prototype.getHeader;m.prototype.getHeader=function(a){return n.call(this,a)||typeof this._raw.getHeader=="function"&&this._raw.getHeader(a)},b.exports=m}),require.define("/node_modules/shred/lib/shred/content.js",function(a,b,c,d,e){var f=a("underscore"),g=function(a){this.body=a.body,this.data=a.data,this.type=a.type};g.prototype={},Object.defineProperties(g.prototype,{type:{get:function(){if(this._type)return this._type;if(this._data)switch(typeof this._data){case"string":return"text/plain";case"object":return"application/json"}return"text/plain"},set:function(a){return this._type=a,this},enumerable:!0},data:{get:function(){return this._body?this.processor.parser(this._body):this._data},set:function(a){return this._body&&a&&j.setDataWithBody(this),this._data=a,this},enumerable:!0},body:{get:function(){return this._data?this.processor.stringify(this._data):this.processor.stringify(this._body)},set:function(a){return this._data&&a&&j.setBodyWithData(this),this._body=a,this},enumerable:!0},processor:{get:function(){var a=g.processors[this.type];return a?a:(a=f(this.type.split(";")[0].split(/\+|\//)).detect(function(a){return g.processors[a]}),g.processors[a]||{parser:h,stringify:i})},enumerable:!0},length:{get:function(){return this.body.length}}}),g.processors={},g.registerProcessor=function(a,b){a.forEach?a.forEach(function(a){g.processors[a]=b}):g.processors[a]=b};var h=function(a){return a},i=function(a){return a.toString()};g.registerProcessor(["text/html","text/plain","text"],{parser:h,stringify:i}),g.registerProcessor(["application/json; charset=utf-8","application/json","json"],{parser:function(a){return JSON.parse(a)},stringify:function(a){return JSON.stringify(a)}});var j={setDataWithBody:function(a){throw new Error("Attempt to set data attribute of a content object when the body attributes was already set.")},setBodyWithData:function(a){throw new Error("Attempt to set body attribute of a content object when the data attributes was already set.")}};b.exports=g}),require.define("/node_modules/shred/lib/shred/mixins/headers.js",function(a,b,c,d,e){var f=a("underscore"),g=function(a){return a.toLowerCase().replace("_","-").replace(/(^|-)(\w)/g,function(a){return a.toUpperCase()})},h=function(a){return{}},i=function(a){return a._headers||(a._headers=h(a))},j=function(a,b){return i(a)[g(b)]},k=function(a,b){var c=b&&b.length>0?b:Object.keys(i(a)),d=c.reduce(function(b,c){return b[c]=j(a,c),b},{});return Object.freeze(d),d},l=function(a,b,c){return i(a)[g(b)]=c,a},m=function(a,b){for(var c in b)l(a,c,b[c]);return this};b.exports={getters:function(a){a.prototype.getHeader=function(a){return j(this,a)},a.prototype.getHeaders=function(){return k(this,f(arguments))}},privateSetters:function(a){a.prototype._setHeader=function(a,b){return l(this,a,b)},a.prototype._setHeaders=function(a){return m(this,a)}},setters:function(a){a.prototype.setHeader=function(a,b){return l(this,a,b)},a.prototype.setHeaders=function(a){return m(this,a)}},gettersAndSetters:function(a){a.prototype.getHeader=function(a){return j(this,a)},a.prototype.getHeaders=function(){return k(this,f(arguments))},a.prototype.setHeader=function(a,b){return l(this,a,b)},a.prototype.setHeaders=function(a){return m(this,a)}}}}),require.define("/spire/api/response_error.js",function(a,b,c,d,e){var f=function(a,b){this.message="ResponseError: "+a.status,this.response=a,this.status=a.status,this.request=b};f.prototype=new Error,b.exports=f}),require.define("/spire/api/account.js",function(a,b,c,d,e){function g(a,b){this.spire=a,this.data=b,this.resourceName="account"}var f=a("./resource");g.prototype=new f,b.exports=g,g.prototype.secret=function(){return this.data.secret},g.prototype.reset=function(a){var b=this;this.request("reset",function(c,d){if(c)return a(c);b.data=d.resources.account,a(null,d)})},g.prototype.updateBillingSubscription=function(a,b){var c=this;this.request("update_billing_subscription",a,function(a,d){if(a)return b(a);c.data=d,b(null,c)})},f.defineRequest(g.prototype,"reset",function(){return{method:"post",url:this.url(),headers:{Accept:this.mediaType(),Authorization:this.authorization("reset")}}}),f.defineRequest(g.prototype,"update_billing_subscription",function(a){var b=this.data.billing;return{method:"put",url:b.url,content:a,headers:{Accept:this.mediaType(),"Content-Type":this.mediaType(),Authorization:this.authorization("update",b)}}}),f.defineRequest(g.prototype,"billing_invoices",function(){var a=this.data.billing.invoices;return{method:"get",url:a.url,headers:{Accept:"application/json",Authorization:"Capability "+a.capability}}}),f.defineRequest(g.prototype,"billing_invoices_upcoming",function(){var a=this.data.billing.invoices.upcoming;return{method:"get",url:a,headers:{Accept:"application/json",Authorization:"Capability "+a.capability}}})}),require.define("/spire/api/billing.js",function(a,b,c,d,e){function g(a,b){this.spire=a,this.data=b,this.resourceName="billing"}var f=a("./resource");g.prototype=new f,b.exports=g}),require.define("/spire/api/channel.js",function(a,b,c,d,e){function h(a,b){this.spire=a,this.data=b,this.resourceName="channel"}var f=a("./resource"),g=a("./message");h.prototype=new f,b.exports=h,h.prototype.name=function(){return this.data.name},h.prototype.publish=function(a,b){var c=this.spire;this.request("publish",{content:a},function(a,d){if(a)return b(a);b(null,new g(c,d))})},h.prototype.subscription=function(a,b){b||(b=a,a=null),this.spire.subscription(a,this.name(),b)},h.prototype.subscriptions=function(a){if(this._subscriptions)return a(null,this._subscriptions);this.subscriptions$(a)},h.prototype.subscriptions=function(a){var b=this;this.request("subscriptions",function(c,d){if(c)return a(c);b._subscriptions=d,a(null,d)})},f.defineRequest(h.prototype,"publish",function(a){return{method:"post",url:this.url(),headers:{Authorization:this.authorization("publish"),Accept:this.mediaType("message"),"Content-Type":this.mediaType("message")},content:a}}),f.defineRequest(h.prototype,"subscriptions",function(a){var b=this.data.resources.subscriptions;return{method:"get",url:b.url,headers:{Authorization:this.authorization("get_subscriptions",b),Accept:this.mediaType("subscriptions")}}})}),require.define("/spire/api/message.js",function(a,b,c,d,e){function g(a,b){this.spire=a,this.data=b,this.content=b.content,this.type=b.type,this.timestamp=b.timestamp,this.resourceName="message"}var f=a("./resource");g.prototype=new f,f.prototype.update=function(a,b){var c=this;this.request("update",a,function(a,d){if(a)return b(a);c.data=d,c.content=d.content,c.timestamp=d.timestamp,b(null,c)})},b.exports=g}),require.define("/spire/api/session.js",function(a,b,c,d,e){function k(a,b){this.spire=a,this.data=b,this.resourceName="session",this._channels={},this._subscriptions={},this._storeResources()}var f=a("./resource"),g=a("./account"),h=a("./channel"),i=a("./subscription"),j=a("underscore");k.prototype=new f,b.exports=k,k.prototype.get=function(a){var b=this;this.request("get",function(c,d){if(c)return a(c);b.data=d,b._storeResources(),a(null,b)})},k.prototype.account=function(a){if(this._account)return a(null,this._account);this.account$(a)},k.prototype.account$=function(a){var b=this;this.request("account",function(c,d){if(c)return a(c);b._account=new g(b.spire,d),a(null,b._account)})},k.prototype.resetAccount=function(a){var b=this;this._account.reset(function(c,d){if(c)return a(c);b.data=d,b._storeResources(),a(null,b)})},k.prototype.channelByName=function(a,b){var c=this;this.request("channel_by_name",a,function(d,e){return d?b(d):b(null,new h(c.spire,e[a]))})},k.prototype.channels=function(a){if(!j.isEmpty(this._channels))return a(null,this._channels);this.channels$(a)},k.prototype.channels$=function(a){var b=this;this.request("channels",function(c,d){if(c)return a(c);j.each(d,function(a,c){b._memoizeChannel(new h(b.spire,a))}),a(null,b._channels)})},k.prototype.subscriptions=function(a){if(!j.isEmpty(this._subscriptions))return a(null,this._subscriptions);this.subscriptions$(a)},k.prototype.subscriptions$=function(a){var b=this;this.request("subscriptions",function(c,d){if(c)return a(c);b._subscriptions={},j.each(d,function(a,c){b._memoizeSubscription(new i(b.spire,a))}),a(null,b._subscriptions)})},k.prototype.subscriptionByName=function(a,b){var c=this;this.request("subscription_by_name",a,function(d,e){return d?b(d):b(null,new i(c.spire,e[a]))})},k.prototype.createChannel=function(a,b,c){var d=this;c||(c=b,b=null);var e={name:a};b!==null&&(e.limit=b),this.request("create_channel",e,function(a,b){if(a)return c(a);var e=new h(d.spire,b);d._memoizeChannel(e),c(null,e)})},k.prototype.createSubscription=function(a,b){var c=a.name,d=a.channelNames||[],e=a.channelUrls||[],f=a.expiration,g=this;this.channels(function(a){e.push.apply(e,j.map(d,function(a){return g._channels[a].url()})),g.request("create_subscription",c,e,f,function(a,c){if(a)return b(a);var d=new i(g.spire,c);g._memoizeSubscription(d),b(null,d)})})},k.prototype._memoizeChannel=function(a){this._channels[a.name()]=a},k.prototype._memoizeSubscription=function(a){this._subscriptions[a.name()]=a},k.prototype._storeResources=function(){var a=this,b={};j.each(this.data.resources,function(c,d){d==="account"&&(c=new g(a.spire,c),a._account=c),b[d]=c}),this.resources=b},f.defineRequest(k.prototype,"account",function(){var a=this.data.resources.account;return{method:"get",url:a.url,headers:{Authorization:this.authorization("get",a),Accept:this.mediaType("account")}}}),f.defineRequest(k.prototype,"channels",function(){var a=this.data.resources.channels;return{method:"get",url:a.url,headers:{Authorization:this.authorization("all",a),Accept:this.mediaType("channels")}}}),f.defineRequest(k.prototype,"channel_by_name",function(a){var b=this.data.resources.channels;return{method:"get",url:b.url,query:{name:a},headers:{Authorization:this.authorization("get_by_name",b),Accept:this.mediaType("channels")}}}),f.defineRequest(k.prototype,"create_channel",function(a){var b=this.data.resources.channels;return{method:"post",url:b.url,content:a,headers:{Authorization:this.authorization("create",b),Accept:this.mediaType("channel"),"Content-Type":this.mediaType("channel")}}}),f.defineRequest(k.prototype,"subscriptions",function(){var a=this.data.resources.subscriptions;return{method:"get",url:a.url,headers:{Authorization:this.authorization("all",a),Accept:this.mediaType("subscriptions")}}}),f.defineRequest(k.prototype,"subscription_by_name",function(a){var b=this.data.resources.subscriptions;return{method:"get",url:b.url,query:{name:a},headers:{Authorization:this.authorization("get_by_name",b),Accept:this.mediaType("subscriptions")}}}),f.defineRequest(k.prototype,"create_subscription",function(a,b,c){var d=this.data.resources.subscriptions;return{method:"post",url:d.url,content:{name:a,channels:b,expiration:c},headers:{Authorization:this.authorization("create",d),Accept:this.mediaType("subscription"),"Content-Type":this.mediaType("subscription")}}})}),require.define("/spire/api/subscription.js",function(a,b,c,d,e){function j(a,b){this.spire=a,this.data=b,this.resourceName="subscription",this.last=null,this.listening=!1}var f=a("./resource"),g=a("./message"),h=a("underscore"),i=a("async");j.prototype=new f,b.exports=j,j.prototype.name=function(){return this.data.name},j.prototype.startListening=function(a){this.listening=!0,this._listen(a)},j.prototype.stopListening=function(){this.listening=!1},j.prototype.retrieveEvents=function(a,b){var c=this,d=this.spire;b||(b=a,a={}),a.orderBy=a.orderBy||"desc";var e=this.request("events",a,function(a,e){if(a)return c.listeners("error").length&&c.emit("error",a),b(a);if(e.messages.length){var f=e.messages;e.messages=h(e.messages).map(function(a){return new g(d,a)})}if(!c.listening)return b(null,e);var i=["messages","joins","parts"];h.each(i,function(a){e[a].length&&c.emit(a,e[a])});var j=h.reduce(i,function(a,b){return a.concat(e[b])},[]);j.sort(function(a,b){return a.timestamp-b.timestamp}),j.length&&process.nextTick(function(){h.each(j,function(a){c.emit(a.type,a)})}),b(null,e)});e.on("socket",function(a){c.emit("socket",a)})},j.prototype.get=j.prototype.retreiveEvents,j.prototype.poll=function(a,b){b||(b=a,a={}),a.timeout=0,this.longPoll(a,b)},j.prototype.longPoll=function(a,b){var c=this;b||(b=a,a={}),a.last=this.last,a.timeout=a.timeout||30,this.retrieveEvents(a,function(a,d){if(a)return b(a);d.last&&(c.last=d.last),b(null,d)})},j.prototype._listen=function(a){var b=this;a=a||{},i.whilst(function(){return b.listening},function(c){b.longPoll(a,c)},function(){})},f.defineRequest(j.prototype,"events",function(a){return a=a||{},{method:"get",url:this.url(),query:{timeout:a.timeout||0,last:a.last||0,"order-by":a.orderBy||"desc",delay:a.delay||0},headers:{Authorization:this.authorization("events"),Accept:this.mediaType("events")}}})}),require.define("/node_modules/http-browserify/package.json",function(a,b,c,d,e){b.exports={main:"index.js",browserify:"browser.js"}}),require.define("/node_modules/http-browserify/browser.js",function(a,b,c,d,e){var f=b.exports,g=a("events").EventEmitter,h=a("./lib/request");f.request=function(a,b){a||(a={}),a.host||(a.host=window.location.host.split(":")[0]),a.port||(a.port=window.location.port);var c=new h(new i,a);return b&&c.on("response",b),c},f.get=function(a,b){a.method="GET";var c=f.request(a,b);return c.end(),c};var i=function(){if(typeof window=="undefined")throw new Error("no window object present");if(window.XMLHttpRequest)return window.XMLHttpRequest;if(window.ActiveXObject){var a=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Microsoft.XMLHTTP"];for(var b=0;b<a.length;b++)try{var c=new window.ActiveXObject(a[b]);return function(){if(c){var d=c;return c=null,d}return new window.ActiveXObject(a[b])}}catch(d){}throw new Error("ajax not supported in this browser")}throw new Error("ajax not supported in this browser")}();f.STATUS_CODES={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Time-out",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Large",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",418:"I'm a teapot",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Unordered Collection",426:"Upgrade Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Time-out",505:"HTTP Version not supported",506:"Variant Also Negotiates",507:"Insufficient Storage",509:"Bandwidth Limit Exceeded",510:"Not Extended"}}),require.define("/node_modules/http-browserify/lib/request.js",function(a,b,c,d,e){var f=a("events").EventEmitter,g=a("./response"),h=a("./isSafeHeader"),i=b.exports=function(a,b){var c=this;c.xhr=a,c.body="";var d=b.host+":"+b.port+(b.path||"/");a.open(b.method||"GET",(b.scheme||"http")+"://"+d,!0),b.headers&&Object.keys(b.headers).forEach(function(c){if(!h(c))return;var d=b.headers[c];Array.isArray(d)?d.forEach(function(b){a.setRequestHeader(c,b)}):a.setRequestHeader(c,d)});var e=new g(a);e.on("ready",function(){c.emit("response",e)}),a.onreadystatechange=function(){e.handle(a)}};i.prototype=new f,i.prototype.setHeader=function(a,b){if(Array.isArray&&Array.isArray(b)||b instanceof Array)for(var c=0;c<b.length;c++)this.xhr.setRequestHeader(a,b[c]);else this.xhr.setRequestHeader(a,b)},i.prototype.write=function(a){this.body+=a},i.prototype.end=function(a){a!==undefined&&this.write(a),this.xhr.send(this.body)}}),require.define("/node_modules/http-browserify/lib/response.js",function(a,b,c,d,e){function j(a){var b=a.getAllResponseHeaders().split(/\r?\n/),c={};for(var d=0;d<b.length;d++){var e=b[d];if(e==="")continue;var f=e.match(/^([^:]+):\s*(.*)/);if(f){var g=f[1].toLowerCase(),h=f[2];c[g]!==undefined?Array.isArray&&Array.isArray(c[g])||c[g]instanceof Array?c[g].push(h):c[g]=[c[g],h]:c[g]=h}else c[e]=!0}return c}var f=a("events").EventEmitter,g=a("./isSafeHeader"),h=b.exports=function(a){this.xhr=a,this.offset=0};h.prototype=new f;var i={streaming:!0,status2:!0};h.prototype.getHeader=function(a){var b=this.headers?this.headers[a.toLowerCase()]:null;return b?b:g(a)?this.xhr.getResponseHeader(a):null},h.prototype.handle=function(){var a=this.xhr;if(a.readyState===2&&i.status2){try{this.statusCode=a.status,this.headers=j(a)}catch(b){i.status2=!1}i.status2&&this.emit("ready")}else if(i.streaming&&a.readyState===3){try{this.statusCode||(this.statusCode=a.status,this.headers=j(a),this.emit("ready"))}catch(b){}try{this.write()}catch(b){i.streaming=!1}}else a.readyState===4&&(this.statusCode||(this.statusCode=a.status,this.emit("ready")),this.write(),a.error?this.emit("error",a.responseText):this.emit("end"))},h.prototype.write=function(){var a=this.xhr;a.responseText.length>this.offset&&(this.emit("data",a.responseText.slice(this.offset)),this.offset=a.responseText.length)}}),require.define("/node_modules/http-browserify/lib/isSafeHeader.js",function(a,b,c,d,e){var f=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","content-transfer-encoding","date","expect","host","keep-alive","origin","referer","set-cookie","te","trailer","transfer-encoding","upgrade","user-agent","via"];b.exports=function(a){return a?f.indexOf(a.toLowerCase())===-1:!1}}),require.alias("http-browserify","/node_modules/http"),require.alias("http-browserify","/node_modules/https")