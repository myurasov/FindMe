<!DOCTYPE html>
<html>
  <head>
    <title>Find me!</title>
    <meta name="viewport" content="initial-scale=1,user-scalable=no,width=device-width">
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
    <script type="text/javascript">var Utils={timeAgo:function(f){var b={refreshMillis:10,allowFuture:false,strings:{prefixAgo:"",prefixFromNow:"",suffixAgo:"",suffixFromNow:"",second:"a second ago",seconds:"%d seconds ago",minute:"about a minute ago",minutes:"%d minutes ago",hour:"about an hour ago",hours:"about %d hours ago",day:"a day ago",days:"%d days ago",month:"about a month ago",months:"%d months ago",year:"about a year ago",years:"%d years ago",numbers:[]}};var h=b.strings;var c=h.prefixAgo;var l=h.suffixAgo;if(b.allowFuture){if(f<0){c=h.prefixFromNow;l=h.suffixFromNow}f=Math.abs(f)}var j=f/1000;var a=j/60;var i=a/60;var k=i/24;var d=k/365;var g=function(m,o){var n=typeof m=="function"?m(o,f):m;var p=(h.numbers&&h.numbers[o])||o;return n.replace(/%d/i,p)};var e=j<1.5&&g(h.second)||j<60&&g(h.seconds,Math.round(j))||j<90&&g(h.minute,1)||a<45&&g(h.minutes,Math.round(a))||a<90&&g(h.hour,1)||i<24&&g(h.hours,Math.round(i))||i<48&&g(h.day,1)||k<30&&g(h.days,Math.floor(k))||k<60&&g(h.month,1)||k<365&&g(h.months,Math.floor(k/30))||d<2&&g(h.year,1)||g(h.years,Math.floor(d));return Utils.trim([c,e,l].join(" "))},trim:function(b){if(typeof b=="string"){b=b.replace(/^\s+/,"");for(var a=b.length-1;a>=0;a--){if(/\S/.test(b.charAt(a))){b=b.substring(0,a+1);break}}}return b},dejitter:function(c,a){var b=function(){var e=(new Date()).getTime();var d=e-b._lastCallTime;if(d>b.interval){b.source.apply(b.source,arguments);b._lastCallTime=e}else{b._deferred.args=arguments;if(b._execDeferred){b._execDeferred=false;b._timeoutId=setTimeout(function(){b._deferred()},b.interval-d)}}};b.source=c;b.interval=a;b.reset=function(){if(b._timeoutId){clearTimeout(b._timeoutId)}b._lastCallTime=0;b._timeoutId=null;b._execDeferred=true};b._deferred=function(){b.source.apply(b.source,b._deferred.args);b._lastCallTime=(new Date()).getTime();b._execDeferred=true};b.reset();return b},setCookie:function(e,b,a){var c=new Date();c.setDate(c.getDate()+a);var d=escape(b)+((a==null)?"":"; expires="+c.toUTCString());document.cookie=e+"="+d},getCookie:function(b){var d=document.cookie.split(";");for(var c=0;c<d.length;c++){var a=d[c].substr(0,d[c].indexOf("="));var e=d[c].substr(d[c].indexOf("=")+1);a=a.replace(/^\s+|\s+$/g,"");if(a==b){return unescape(e)}}return null},geoDistance:function(o,n,i){var e=6372.8;var h=180/Math.PI;var f=(n.lon-o.lon)/h;var m=Math.pow(Math.cos(n.lat/h)*Math.sin(f),2);var l=Math.pow(Math.cos(o.lat/h)*Math.sin(n.lat/h)-Math.sin(o.lat/h)*Math.cos(n.lat/h)*Math.cos(f),2);var k=Math.sin(o.lat/h)*Math.sin(n.lat/h)+Math.cos(o.lat/h)*Math.cos(n.lat/h)*Math.cos(f);var g=Math.atan2(Math.sqrt(m+l),k);var j=e*g;if(i=="mi"){j/=1.609344}else{if(i=="nmi"){j/=1.852}else{if(i=="m"){j*=1000}}}return j}};</script>
    <script type="text/javascript">var findme=function(){var n=this;var i;var f=false;var l;var c;var k;var b;var m=function(){i=window.location.pathname.substr(1);if(i.length==0){i=window.location.search.substr(1)}k=Utils.getCookie("clientUID");if(k==null){k=Math.random().toString().substring(2);Utils.setCookie("clientUID",k,365)}if(i!=""){setInterval(j,1000);g(function(){d();e()});document.getElementById("address").onclick=h}};var e=function(){if(navigator.geolocation){var p=function(q){console.log("updateLocation",arguments);q=q==undefined?false:true;if(!q&&c!=null){var r=Date.now()-l-c._timestamp}if(q||r<15*60*1000){console.log("trying to get location");navigator.geolocation.getCurrentPosition(function(s){console.log("got location",s);b={lat:s.coords.latitude,lon:s.coords.longitude};a({lat:s.coords.latitude,lon:s.coords.longitude,clientUID:k,_timestamp:Date.now()-l})},function(s){console.log("geolocation  error",s)}),{enableHighAccuracy:true}}};setInterval(p,10000);p(true)}};var g=function(p){PUBNUB.time(function(q){var r=Math.round(q/10000);l=Date.now()-r;if(p!=undefined){p()}})};var o=function(p){c=p;j();h()};var d=function(){PUBNUB.history({channel:i,limit:1},function(p){if(c==null&&p.length>0){o(p[0])}});PUBNUB.subscribe({channel:i,restore:false,callback:o})};var a=function(p){console.log('sending feedback to "'+i+'_feedback"',p);PUBNUB.publish({channel:i+"_feedback",message:p})};var j=function(){if(c!=null){var r=Date.now()-l-c._timestamp;document.getElementById("ago").innerHTML="updated "+Utils.timeAgo(r);var s="";if(b!=null&&c!=null){var q="en_US";var p="mi";if(navigator.language){q=navigator.language}if(navigator.browserLanguage){q=navigator.browserLanguage}if(navigator.systemLanguage){q=navigator.systemLanguage}if(navigator.userLanguage){q=navigator.userLanguage}if(q.indexOf("en")!=-1){p="mi"}else{p="km"}s=Utils.geoDistance(b,c.location,p);s=Math.round(s*10)/10;s='<span id="dist">'+s+" "+p+"</span>"}document.getElementById("address").innerHTML=s+c.location.address}};var h=function(){var p=new google.maps.LatLng(c.location.lat,c.location.lon);if(!f){f=true;var q={zoom:16,center:p,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:false,panControl:false,panControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT},zoomControl:true,zoomControlOptions:{style:google.maps.ZoomControlStyle.LARGE,position:google.maps.ControlPosition.LEFT_CENTER},scaleControl:true,scaleControlOptions:{position:google.maps.ControlPosition.BOTTOM_LEFT},streetViewControl:false};n.map=new google.maps.Map(document.getElementById("map"),q);n.marker=new google.maps.Marker({position:p,map:n.map})}else{n.map.setCenter(p);n.marker.setPosition(p)}};m()};</script>
    <style type="text/css">body,html{height:100%;margin:0;padding:0;font-family:"Myriad Pro","Trebuchet MS","Verdana",sans-serif}#map{height:100%;width:100%}#header{padding:10px 0 10px 0;font-size:20px;position:fixed;z-index:1;background-color:white;opacity:.92;box-shadow:0 0 15px #333;width:100%}#address{float:left;margin-left:10px;overflow:hidden;text-overflow:ellipsis}#ago{float:right;margin-right:10px;overflow:hidden;text-overflow:ellipsis;color:gray}#dist{margin-right:7px;display:inline-block;padding:3px 5px 3px 5px;background-color:#EEE;border-radius:3px;color:#444}@media only screen and (min-device-width :320px) and (max-device-width :480px){#address{float:none;font-size:18px}#ago{float:none;margin-right:0;margin-left:10px;font-size:12px}}</style>
  </head>
  <body onload="new findme()">
    <div pub-key="pub-a29834f0-2cd0-40a3-b0e4-5564a7c38df4" sub-key="sub-e4cc5bb3-9372-11e1-b75e-09816d97dcf7" ssl="off" origin="pubsub.pubnub.com" id="pubnub"></div>
    <script type="text/javascript">(window.JSON&&window.JSON["stringify"])||(function(){window.JSON||(window.JSON={});if(typeof String.prototype.toJSON!=="function"){String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];if(typeof k==="string"){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text){return eval("("+text+")")}}}());window.PUBNUB||(function(){window.console||(window.console=window.console||{});console.log||(console.log=((window.opera||{}).postError||function(){}));function c(){return"x"+ ++o+""+(+new Date)}function B(){return +new Date}var r=(function(){var P=window.localStorage;return{get:function(Q){try{if(P){return P.getItem(Q)}if(document.cookie.indexOf(Q)==-1){return null}return((document.cookie||"").match(RegExp(Q+"=([^;]+)"))||[])[1]||null}catch(R){return}},set:function(Q,R){try{if(P){return P.setItem(Q,R)&&0}document.cookie=Q+"="+R+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(S){return}}}})();var o=1,m="https://dh15atwfs066y.cloudfront.net/pubnub.swf",F=/{([\w\-]+)}/g,I="async",p="/",G=140000,g=1000,A=navigator.userAgent,a=A.indexOf("MSIE 6")==-1;var t=(function(){var P=Math.floor(Math.random()*9)+1;return function(Q){return Q.indexOf("pubsub")>0&&Q.replace("pubsub","ps"+(++P<10?P:P=1))||Q}})();function N(Q,R){var T,S=0,P=function(){if(S+R>B()){clearTimeout(T);T=setTimeout(P,R)}else{S=B();Q()}};return P}function D(P){return document.getElementById(P)}function h(P){console.log(P)}function M(Q,R){var P=[];J(Q.split(/\s+/),function(S){J((R||document).getElementsByTagName(S),function(T){P.push(T)})});return P}function J(S,R){if(!S||!R){return}if(typeof S[0]!="undefined"){for(var Q=0,P=S.length;Q<P;){R.call(S[Q],S[Q],Q++)}}else{for(var Q in S){S.hasOwnProperty&&S.hasOwnProperty(Q)&&R.call(S[Q],Q,S[Q])}}}function y(Q,P){var R=[];J(Q||[],function(T,S){R.push(P(T,S))});return R}function O(Q,P){var R=[];J(Q||[],function(S){P(S)&&R.push(S)});return R}function w(Q,P){return Q.replace(F,function(S,R){return P[R]||S})}function f(R,Q,P){J(R.split(","),function(T){var S=function(U){if(!U){U=window.event}if(!P(U)){U.cancelBubble=true;U.returnValue=false;U.preventDefault&&U.preventDefault();U.stopPropagation&&U.stopPropagation()}};if(Q.addEventListener){Q.addEventListener(T,S,false)}else{if(Q.attachEvent){Q.attachEvent("on"+T,S)}else{Q["on"+T]=S}}})}function u(R,Q,P){if(Q.removeEventListener){Q.removeEventListener(R,false)}else{if(Q.detachEvent){Q.detachEvent("on"+R,false)}else{Q["on"+R]=null}}}function q(){return M("head")[0]}function s(Q,P,R){if(R){Q.setAttribute(P,R)}else{return Q&&Q.getAttribute&&Q.getAttribute(P)}}function H(P,R){for(var Q in R){if(R.hasOwnProperty(Q)){try{P.style[Q]=R[Q]+("|width|height|top|left|".indexOf(Q)>0&&typeof R[Q]=="number"?"px":"")}catch(S){}}}}function i(P){return document.createElement(P)}function L(P,Q){return setTimeout(P,Q)}function v(){return a||C()?0:c()}function d(P){return y((encodeURIComponent(P)).split(""),function(Q){return"-_.!~*'()".indexOf(Q)<0?Q:"%"+Q.charCodeAt(0).toString(16).toUpperCase()}).join("")}var x={list:{},unbind:function(P){x.list[P]=[]},bind:function(Q,P){(x.list[Q]=x.list[Q]||[]).push(P)},fire:function(P,Q){J(x.list[P]||[],function(R){R(Q)})}};function n(T){if(a||C()){return E(T)}var W=i("script"),X=T.callback,P=c(),U=0,Q=L(function(){V(1)},G),S=T.fail||function(){},Y=T.success||function(){},R=function(){q().appendChild(W)},V=function(Z,aa){if(U){return}U=1;Z||Y(aa);W.onerror=null;clearTimeout(Q);L(function(){Z&&S();var ab=D(P),ac=ab&&ab.parentNode;ac&&ac.removeChild(ab)},g)};window[X]=function(Z){V(0,Z)};W[I]=I;W.onerror=function(){V(1)};W.src=T.url.join(p);s(W,"id",P);R();return V}function E(S){var Y,T=function(){if(W){return}W=1;clearTimeout(P);try{response=JSON.parse(Y.responseText)}catch(Z){return U(1)}X(response)},Q=0,W=0,P=L(function(){U(1)},G),R=S.fail||function(){},X=S.success||function(){},U=function(Z){if(Q){return}Q=1;clearTimeout(P);if(Y){Y.onerror=Y.onload=null;Y.abort&&Y.abort();Y=null}Z&&R()};try{Y=C()||window.XDomainRequest&&new XDomainRequest()||new XMLHttpRequest();Y.onerror=Y.onabort=function(){U(1)};Y.onload=Y.onloadend=T;Y.timeout=G;Y.open("GET",S.url.join(p),true);Y.send()}catch(V){U(0);a=0;return n(S)}return U}var k=D("pubnub")||{},z=1800,j=0,b=[],K=function(P){var U={},S=P.publish_key||"",R=P.subscribe_key||"",V=P.ssl?"s":"",Q="http"+V+"://"+(P.origin||"pubsub.pubnub.com"),T={history:function(X,aa){var aa=X.callback||aa,W=X.limit||100,Y=X.channel,Z=v();if(!Y){return h("Missing Channel")}if(!aa){return h("Missing Callback")}n({callback:Z,url:[Q,"history",R,d(Y),Z,W],success:function(ab){aa(ab)},fail:function(ab){h(ab)}})},time:function(X){var W=v();n({callback:W,url:[Q,"time",W],success:function(Y){X(Y[0])},fail:function(){X(0)}})},uuid:function(X){var W=v();n({callback:W,url:["http"+V+"://pubnub-prod.appspot.com/uuid?callback="+W],success:function(Y){X(Y[0])},fail:function(){X(0)}})},publish:function(X,ab){var ab=ab||X.callback||function(){},Z=X.message,Y=X.channel,aa=v(),W;if(!Z){return h("Missing Message")}if(!Y){return h("Missing Channel")}if(!S){return h("Missing Publish Key")}Z=JSON.stringify(Z);W=[Q,"publish",S,R,0,d(Y),aa,d(Z)];if(W.join().length>z){return h("Message Too Big")}n({callback:aa,success:function(ac){ab(ac)},fail:function(){ab([0,"Disconnected"])},url:W})},unsubscribe:function(W){var X=W.channel;if(!(X in U)){return}U[X].connected=0;U[X].done&&U[X].done(0)},subscribe:function(ab,ah){var Z=ab.channel,ah=ah||ab.callback,aa=ab.restore,af=0,ac=ab.error||function(){},ai=ab.connect||function(){},W=ab.reconnect||function(){},ag=ab.disconnect||function(){},ad=0,X=0,ae=t(Q);if(!j){return b.push([ab,ah,T])}if(!Z){return h("Missing Channel")}if(!ah){return h("Missing Callback")}if(!R){return h("Missing Subscribe Key")}if(!(Z in U)){U[Z]={}}if(U[Z].connected){return h("Already Connected")}U[Z].connected=1;function Y(){var aj=v();if(!U[Z].connected){return}U[Z].done=n({callback:aj,url:[ae,"subscribe",R,d(Z),aj,af],fail:function(){if(!ad){ad=1;ag()}L(Y,g);T.time(function(ak){ak||ac()})},success:function(ak){if(!U[Z].connected){return}if(!X){X=1;ai()}if(ad){ad=0;W()}aa=r.set(R+Z,af=aa&&r.get(R+Z)||ak[1]);J(ak[0],function(al){ah(al,ak)});L(Y,10)}})}Y()},xdr:n,ready:e,db:r,each:J,map:y,css:H,"$":D,create:i,bind:f,supplant:w,head:q,search:M,attr:s,now:B,unique:c,events:x,updater:N,init:K};return T};PUBNUB=K({publish_key:s(k,"pub-key"),subscribe_key:s(k,"sub-key"),ssl:s(k,"ssl")=="on",origin:s(k,"origin")});H(k,{position:"absolute",top:-g});if("opera" in window||s(k,"flash")){k.innerHTML="<object id=pubnubs data="+m+"><param name=movie value="+m+"><param name=allowscriptaccess value=always></object>"}var l=D("pubnubs")||{};function e(){PUBNUB.time(B);PUBNUB.time(function(P){L(function(){if(j){return}j=1;J(b,function(Q){Q[2]["subscribe"](Q[0],Q[1])})},g)})}f("load",window,function(){L(e,0)});PUBNUB.rdx=function(Q,P){if(!P){return C[Q]["onerror"]()}C[Q]["responseText"]=unescape(P);C[Q]["onload"]()};function C(){if(!l.get){return 0}var P={id:C.id++,send:function(){},abort:function(){P.id={}},open:function(R,Q){C[P.id]=P;l.get(P.id,Q)}};return P}C.id=g;window.jQuery&&(window.jQuery["PUBNUB"]=PUBNUB);typeof module!=="undefined"&&(module.exports=PUBNUB)&&e()})();</script>
    <div id="header">
      <div id="address">Locating...</div>
      <div id="ago"></div>
    </div>
    <div id="map"></div>
  </body>
</html>
